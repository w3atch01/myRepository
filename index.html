<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>To do List!</h1>
    <input type="text" class="js-input" onkeydown="keyDown()">
    <br>
    <button class="js-add" onclick="addToList()" >Add</button>
    <button class="js-first" onclick="remove('first')">Remove first task</button>
    <button class="js-last" onclick="remove('last')">Remove last task</button>
    <button class="js-all" onclick="remove('all')">Remove All tasks!</button>

    <p class="js-list"></p>

    <script>
        let list = [];

        if (localStorage.getItem('listSave')) {
            list = JSON.parse(localStorage.getItem('listSave'));
        } else if (!localStorage.getItem('listSave')) {
            list = [];
        }

        console.log(localStorage.getItem('listSave'));

        // Function to add a task to the list
        function addToList() {
            const task = document.querySelector(".js-input").value;  // Get the task input value

            if (!task) {  // Check if the input is empty
                document.querySelector('.js-list').innerHTML = "Please enter a task!";
            } else {
                list.push(task);  // Add the task to the list
                console.log(list);

                // Clear the input field after adding the task
                document.querySelector(".js-input").value = "";

                // Update localStorage with the new task list
                localStorage.setItem('listSave', JSON.stringify(list));

                // --- Send the task to Google Sheets ---
                fetch('https://script.google.com/macros/s/AKfycbyO0QayKjys51-G8x3jJp_LZNr_WEov_pJ7A9QWqQ4gwJQVAV_SckwRMpoq_uEhMNHN/exec', {
                    method: 'POST',  // Send a POST request
                    body: JSON.stringify({ task: task }),  // Send the task as a JSON object
                    headers: {
                        'Content-Type': 'application/json'  // Tell the server it's JSON data
                    }
                })
                .then(response => response.text())  // Convert the response to text
                .then(data => console.log('Task sent to Google Sheets:', data))  // Log the response data (optional)
                .catch((error) => console.error('Error sending task to Google Sheets:', error));  // Handle any errors
            }
        }

        function keyDown() {
            if (event.key == "Enter") {
                addToList();
            }
        }

        function remove(task) {
            if (task == "first") {
                list.shift();
            } else if (task == 'last') {
                list.pop();
            } else if (task == "all") {
                list = [];
                alert("All tasks removed successfully!");
            }

            localStorage.setItem('listSave', JSON.stringify(list));
            console.log(list);
        }
    </script>
</body>
</html>
